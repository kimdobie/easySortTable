//jquery.easySortTable.js - version 1.1.0

var sortTableVars={};sortTableVars.noSortClass="noSort";sortTableVars.sortHeaderClass="sortHeader";sortTableVars.sortLinkTextClass="sortLinkText";sortTableVars.headerLinkTitle="Sort this column";sortTableVars.alreadySortedAscendingClass="sortedAscending";sortTableVars.alreadySortedDescendingClass="sortedDescending";sortTableVars.sortArrowClass="sortArrow";sortTableVars.ascSortArrow="&nbsp;&darr;";sortTableVars.descSortArrow="&nbsp;&uarr;";sortTableVars.sortDirectionAscClass="sortDirectionAsc"; sortTableVars.sortDirectionDesClass="sortDirectionDes";sortTableVars.sortKeyClassStart="dataType_";sortTableVars.sortFunctionClassStart="sort_";sortTableVars.sortKeyClass="sortKey";sortTableVars.sortedColumnClass="sortedCol";sortTableVars.sortHeaderRowClass="sortHeaderRow";sortTableVars.secondarySortClass="secondarySort_"; jQuery.fn.alternateRowColors=function(){jQuery("tbody tr:visible:odd",this).removeClass("odd").addClass("even");jQuery("tbody tr:visible:even",this).removeClass("even").addClass("odd");return this}; jQuery.fn.easySortTable=function(){return this.each(function(){var a;a=jQuery(this).find("tr."+sortTableVars.sortHeaderRowClass).length>0?jQuery(this).find("tr."+sortTableVars.sortHeaderRowClass).eq(0):jQuery(this).find("thead").length>0?jQuery(this).find("thead tr:last"):jQuery(this).find("tr:first");if(jQuery(a).parents("thead").length==0){jQuery(this).prepend("<thead></thead>");jQuery(this).find("thead:first").append(a)}jQuery(a).children().each(function(b){jQuery(this).setSortLink(b)});jQuery(this).alternateRowColors()})}; jQuery.fn.setSortLink=function(a,b){if(!jQuery(this).hasClass(sortTableVars.noSortClass)){if(a==undefined||a==""){var c=jQuery(this).parents("tr").eq(0),h;jQuery(this).each(function(){h=this});jQuery(c).find("th").each(function(f){if(this==h)a=f});if(a==undefined||a=="")jQuery(c).find("td").each(function(f){if(this==h)a=f})}c=this;var g=true;b="";if(jQuery(c).find("."+sortTableVars.sortHeaderClass).length>0){c=jQuery(c).find("."+sortTableVars.sortHeaderClass).eq(0);jQuery(c).removeClass(sortTableVars.sortHeaderClass); c=c;g=false}jQuery(c).wrapInner('<a href="javascript:void(0)"><span class="'+sortTableVars.sortLinkTextClass+'"></span></a>');var i=jQuery(c).find("a:first");i.attr("title",sortTableVars.headerLinkTitle).addClass(sortTableVars.sortHeaderClass);if(jQuery(c).hasClass(sortTableVars.alreadySortedAscendingClass))b=1;if(jQuery(c).hasClass(sortTableVars.alreadySortedDescendingClass))b=-1;i.setSortArrow(b,false);g&&i.css("display","block");i.click(function(){jQuery(this).sortTableColumn(a)})}return this}; jQuery.fn.setSecondarySort=function(){jQuery(this).removeSecondarySort();for(var a=jQuery(this).sortGetParentCell(),b=sortTableVars.secondarySortClass,c=0;c<arguments.length;c++)if(typeof arguments[c]=="object"){if(c!=0)b+="_";var h=jQuery(arguments[c]).sortGetTableCellIndex();b+=h+"_";b+=arguments[c+1]!="object"&&arguments[c+1]!=undefined?arguments[c+1]:"0"}jQuery(a).addClass(b)}; jQuery.fn.setSecondarySortByIndex=function(){if(arguments.length%2!=0){alert("Odd number of arguments sent to the setSecondarySortByIndex method");return this}for(var a=jQuery(this).sortGetParentCell(),b=sortTableVars.secondarySortClass,c=0;c<arguments.length;c++){if(c!=0)b+="_";b+=arguments[c]}jQuery(a).addClass(b)}; jQuery.fn.removeSecondarySort=function(){var a=jQuery(this).sortCheckForClass(sortTableVars.secondarySortClass);if(a!=""){jQuery(this).removeClass(a);return this}a=jQuery(this).parent("th");if(a.length!=0){var b=jQuery(a).eq(0).sortCheckForClass(sortTableVars.secondarySortClass);if(b!=""){jQuery(a).eq(0).removeClass(b);return this}}a=jQuery(this).parent("td");if(a.length!=0){b=jQuery(a).eq(0).sortCheckForClass(sortTableVars.secondarySortClass);if(b!=""){jQuery(a).eq(0).removeClass(b);return this}}return this}; jQuery.fn.setSortArrow=function(a,b){if(b!=false)b=true;jQuery(this).find("."+sortTableVars.sortArrowClass).length==0&&jQuery(this).append("<span class='"+sortTableVars.sortArrowClass+"'></span>");b&&jQuery(this).parents("table").eq(0).find("."+sortTableVars.sortArrowClass).empty();jQuery(this).removeClass(sortTableVars.sortDirectionAscClass).removeClass(sortTableVars.sortDirectionDesClass).find("."+sortTableVars.sortArrowClass).eq(0).empty();if(a==1)jQuery(this).addClass(sortTableVars.sortDirectionAscClass).find("."+ sortTableVars.sortArrowClass).eq(0).html(sortTableVars.ascSortArrow);else a==-1&&jQuery(this).addClass(sortTableVars.sortDirectionDesClass).find("."+sortTableVars.sortArrowClass).eq(0).html(sortTableVars.descSortArrow);return this}; jQuery.fn.sortTableColumn=function(a,b,c,h){dataType_alpha=function(d){if(jQuery.browser.msie){var e=d.html().replace(/&nbsp;+/g," ");d.html(e)}return jQuery.trim(d.find("."+sortTableVars.sortKeyClass).text().toUpperCase())+" "+jQuery.trim(d.text().toUpperCase())};dataType_numeric=function(d){var e=d.text();if(d.find("."+sortTableVars.sortKeyClass).length>0)e=d.find("."+sortTableVars.sortKeyClass).eq(0);d=parseFloat(e.replace(/^[^\d.]*/,""));return isNaN(d)?0:d};dataType_date=function(d){if(jQuery.browser.msie){var e= d.html().replace(/&nbsp;+/g," ");d.html(e)}e=jQuery.trim(d.text());if(d.find("."+sortTableVars.sortKeyClass).length>0)e=jQuery.trim(d.find("."+sortTableVars.sortKeyClass).eq(0));return e.substr(6,4)+e.substr(0,2)+e.substr(3,2)};sort_default=function(d,e){for(var j=0;j<d.sortKey.length;j++){if(d.sortKey[j]>e.sortKey[j])return d.sortDirection[j];if(d.sortKey[j]<e.sortKey[j])return-d.sortDirection[j]}return 0};checkSecondarySort=function(d){d=jQuery(d).sortCheckForClass(sortTableVars.secondarySortClass); if(d=="")return"";d=d.split("_");d.shift();if(d.length%2!=0){alert("incorrect number of items set in the secondarySort class");return""}for(var e=[],j=0;j<d.length;j+=2)e.push(Array(d[j],d[j+1]));return e};var g=false,i;if(typeof a!="object"){i=Array(Array(a,b,c));g=true}else{i=a;h=b}var f,k,r,o=i[0][0];c=i[0][1];f=jQuery(this).getTagName();if(f=="table"||f=="TABLE"){k=this;if(o==undefined){alert("No column index was passed to the sortTableColumn function - sorting did not happen.");return this}headerRow= jQuery(k).find("tr."+sortTableVars.sortHeaderRowClass).length>0?jQuery(k).find("tr."+sortTableVars.sortHeaderRowClass).eq(0):jQuery(k).find("thead").length>0?jQuery(k).find("thead tr:last"):jQuery(k).find("tr:first");f=jQuery(headerRow).children().eq(o);r=jQuery(f).find("."+sortTableVars.sortHeaderClass).eq(0)}else if(f=="td"||f=="TD"||f=="th"||f=="TH"){f=this;headerRow=jQuery(f).parents("tr").eq(0);k=jQuery(this).parents("table").eq(0);r=jQuery(this).find("."+sortTableVars.sortHeaderClass).eq(0)}else if((f== "a"||f=="A")&&jQuery(this).hasClass(sortTableVars.sortHeaderClass)){f=jQuery(this).parents("th").length>0?jQuery(this).parents("th").eq(0):jQuery(this).parents("td").eq(0);headerRow=jQuery(f).parents("tr").eq(0);k=jQuery(this).parents("table").eq(0);r=this}else{alert("Improper object daisy-chained to the sortTableColumn function - sorting did not happen.");return this}if(g){g=checkSecondarySort(f);if(g!=""&&g.length>0)for(var l=0;l<g.length;l++)i.push(g[l])}if(o==undefined||o==""){g=jQuery(f).parents("tr").eq(0); var s;jQuery(f).each(function(){s=this});jQuery(g).find("th").each(function(d){if(this==s)i[0][0]=d});if(a==undefined||a=="")jQuery(g).find("td").each(function(d){if(this==s)i[0][0]=d});o=i[0][0]}g=jQuery(k).find("tbody > tr").get();for(var n=0;n<i.length;n++){a=i[n][0];b=i[n][1];var m=i[n][2];if(b==0)b=c;if(b==undefined||b==""||b!=1&&b!=-1){b=jQuery(headerRow).children().eq(a).find("."+sortTableVars.sortHeaderClass).eq(0).hasClass(sortTableVars.sortDirectionAscClass)?-1:1;if(n==0)c=b}if(m==undefined|| m==""){m="";if(l=jQuery(headerRow).children().eq(a).sortCheckForClass(sortTableVars.sortKeyClassStart))m=eval(l)}if(m==""){m=dataType_alpha;jQuery(headerRow).children().eq(a).addClass("dataType_alpha");var p="";for(l=0;p=="";l++){var q=jQuery(k).find("tbody tr").eq(l).find("td").eq(a);if(jQuery.browser.msie){var t=jQuery(q).html().replace(/&nbsp;+/g," ");jQuery(q).html(t)}q=jQuery.trim(jQuery(k).find("tbody tr").eq(l).find("td").eq(a).text());if(q!="")p=q}if(p.match(/^\d\d[\/-]\d\d[\/-]\d\d\d\d$/)){m= dataType_date;jQuery(headerRow).children().eq(a).removeClass("dataType_alpha").addClass("dataType_date")}if(p.match(/^\d\d[\/-]\d\d[\/-]\d\d$/)){m=dataType_date;jQuery(headerRow).children().eq(a).removeClass("dataType_alpha").addClass("dataType_date")}if(p.match(/^[\u00a3$]/)){m=dataType_numeric;jQuery(headerRow).children().eq(a).removeClass("dataType_alpha").addClass("dataType_numeric")}if(p.match(/^[\d\.]+$/)){m=dataType_numeric;jQuery(headerRow).children().eq(a).removeClass("dataType_alpha").addClass("dataType_numeric")}}jQuery.each(g, function(d,e){if(n==0){e.sortKey=[];e.sortDirection=[]}e.sortKey[n]=m(jQuery(e).children("td").eq(a));e.sortDirection[n]=b})}if(h==undefined||h==""){h="";l=jQuery(f).sortCheckForClass(sortTableVars.sortFunctionClassStart);if(l!="")sortKey=eval(l)}if(h==""){h=sort_default;jQuery(f).addClass("sort_default")}g.sort(h);jQuery.each(g,function(d,e){jQuery(k).children("tbody").append(e);jQuery(e).find("."+sortTableVars.sortedColumnClass).removeClass(sortTableVars.sortedColumnClass);jQuery(e).find("td").eq(o).addClass(sortTableVars.sortedColumnClass); e.sortKey=null;e.sortDirection=null});jQuery(f).parents("tr").eq(0).find("."+sortTableVars.sortedColumnClass).removeClass(sortTableVars.sortedColumnClass);jQuery(f).addClass(sortTableVars.sortedColumnClass);jQuery(k).alternateRowColors();jQuery(r).setSortArrow(c);typeof sortTableCallBack!="undefined"&&sortTableCallBack({index:a,direction:b});return this}; jQuery.fn.sortCheckForClass=function(a){var b=[];a=RegExp(a);b=jQuery(this).attr("class").split(" ");for(var c=0;c<b.length;c++)if(b[c].match(a))return b[c];return""};jQuery.fn.getTagName=function(){var a="";jQuery(this).each(function(){a=this.tagName});return a};jQuery.fn.sortGetParentCell=function(){var a=jQuery(this).getTagName();if(a=="th"||a=="TH"||a=="td"||a=="TD")return this;a=jQuery(this).parent("th");if(a.length>0)return a.eq(0);a=jQuery(this).parent("td");if(a.length>0)return a.eq(0);return this}; jQuery.fn.sortGetTableCellIndex=function(){var a=jQuery(this).sortGetParentCell(),b=jQuery(a).parents("tr").eq(0),c,h="";jQuery(a).each(function(){c=this});jQuery(b).find("th").each(function(g){if(this==c){h=g;alert("th "+g)}});if(h==undefined||h=="")jQuery(b).find("td").each(function(g){if(this==c)h=g});return h};